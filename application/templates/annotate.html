{% extends "base.html" %}
{% block title %}GÁN NHÃN{% endblock %}
{% block content %}
<h1 align="center">CÔNG CỤ GÁN NHÃN</h1>

<!-- Add CSS style for the progress bar -->
<style>
    .progress-bar {
        width: 100%;
        height: 40px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f1f1f1;
        position: relative;
    }

    .completed-bar {
        height: 100%;
        background-color: #4CAF50;
        border-radius: 5px;
    }

    .incomplete-bar {
        height: 100%;
        background-color: #f44336;
        border-radius: 5px;
    }

    .progress-text {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        line-height: 20px;
    }
</style>

<div class="progress-bar">
    <!-- Calculate the percentage of completed tasks -->
    {% set percentage_completed = (n_completed / last) * 100 %}
    <!-- Render the completed bar -->
    <div class="completed-bar" style="width: {{ percentage_completed }}%"></div>
    <!-- Render the incomplete bar -->
    <div class="incomplete-bar" style="width: {{ 100 - percentage_completed }}%"></div>
    <!-- Display the progress text -->
    <div class="progress-text text-success"><strong>{{ n_completed }} / {{ last }} sample hoàn thành gán nhãn</strong></div>
</div>

<br>

<!-- Options -->
<div class="d-flex justify-content-center">
    <button class="btn btn-primary mr-3" id="previous" onclick="window.location.href='/annotate/?index={{ rcmt_idx - 1 }}'">
        <i class="fas fa-arrow-left"></i> Lui lại
    </button>
    <button class="btn btn-primary mr-3" id="from-beginning" onclick="window.location.href='/annotate/?index=1'">
        <i class="fas fa-fast-backward"></i> Gán nhãn từ đầu
    </button>
    <button class="btn btn-primary mr-3" id="from-end" onclick="window.location.href='/annotate/?index={{ last }}'">
        <i class="fas fa-fast-forward"></i> Nhảy đến cuối
    </button>
    <button class="btn btn-primary mr-3" id="next" onclick="window.location.href='/annotate/?index={{ rcmt_idx + 1 }}'">
        <i class="fas fa-arrow-right"></i> Tiếp theo
    </button>
</div>
<style>
    /* Add custom CSS styles */
    body, html {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    .form-container {
        display: flex;
        flex-direction: column; /* Change to column direction */
        align-items: flex-start;
        padding: 20px;
    }
    form {
        max-width: 1000px; /* Limit the maximum width of the form */
    }
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
    }
    /* Highlight the aspect row */
    tr.aspect-row {
        background-color: #f2f2f2;
    }
    /* Adjust the margin of the submit button */
    .submit-btn {
        margin-top: 15px; /* Change this value to adjust the gap */
    }
</style>

<!-- Extract annotation -->
{% if ann_data is not none %}
    <h2 class="text-success text-center">Mẫu số <strong>{{ current_idx }}</strong>. Bạn đã gán nhãn mẫu dữ liệu này. Bạn đang cập nhật!</h2>
    {% set label = ann_data['label'] %}
    {% set explanation = ann_data['explanation'] %}
{% else %}
    <h2 class="text-danger text-center">Mẫu số <strong>{{ current_idx }}</strong>. Bạn chưa từng gán nhãn mẫu dữ liệu này!</h2>
    {% set label = '' %}
    {% set explanation = '' %}
{% endif %}

<!-- Labeling -->
<form action="{{ url_for('views.annotate', index=current_idx) }}" method="post">
    <!-- Labeling Input -->
    <div class="labeling-inputs">
        <label for="labeling-select">Nhãn:</label>
        <select name="labeling_select" id="labeling-select" required>
            <option value="">Bạn chưa chọn</option>
            <option value="clean" {% if label == 'clean' %}selected{% endif %}>Clean</option>
            <option value="seeding" {% if label == 'seeding' %}selected{% endif %}>Seeding</option>
            <option value="warning" {% if label == 'warning' %}selected{% endif %}>Warning</option>
        </select>
        <br>
        <label for="explanation">Viết câu giải thích:</label>
        <input type="text" name="explanation" id="explanation" maxlength="500" style="width: 100%;" value={{ explanation }}>
    </div>

    <!-- Submit button -->
    <div class="submit-btn text-center">
        <input type="submit" value="Submit">
    </div>
    <br>

    <!-- Data -->
    <table>
        {% for aspect, attributes in rcmt_data.items() %}
            <!-- Each aspect -->
            <tr class="aspect-row">
                <th colspan="2">{{ aspect }}</th>
                <td>
                    <select name="{{ aspect }}" required>
                        <option value="">Bạn chưa chọn</option>
                        <option value="negative" {% if ann_data is not none and ann_data[aspect] == 'negative' %}selected{% endif %}>negative</option>
                        <option value="neutral" {% if ann_data is not none and ann_data[aspect] == 'neutral' %}selected{% endif %}>neutral</option>
                        <option value="positive" {% if ann_data is not none and ann_data[aspect] == 'positive' %}selected{% endif %}>positive</option>
                    </select>
                </td>
            </tr>
            {% for attribute, value in attributes.items() %}
                {% if value is not none %}
                <tr>
                    <td>{{ attribute }}</td>
                    {% if attribute == 'body' %}
                        <td>{{ value|safe }}</td>
                    {% else %}
                        <td>{{ value }}</td>
                    {% endif %}
                    <td></td> <!-- Add an empty column for the select option -->
                </tr>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </table>
    <br>
</form>

{% endblock %}