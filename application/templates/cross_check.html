{% extends "base.html" %}
{% block title %}CROSS-CHECK{% endblock %}
{% block content %}
<h1 align="center"> CROSS CHECKING USER {{ validated_user_id, validatede_name }} | <a href="https://drive.google.com/drive/folders/1EL6WA2VGSWY4eY02XsOGGTyV1Fpo_e5E?fbclid=IwAR1XxEPc2N1mn8DZPDag6KnhncnXniyh0nqb3aR7xmCEiihdotsPaGe0gTc">GUIDELINE</a></h1>

<!-- Add CSS style for the progress bar -->
<style>
    .progress-bar {
        width: 100%;
        height: 40px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f1f1f1;
        position: relative;
    }

    .completed-bar {
        height: 100%;
        background-color: #4CAF50;
        border-radius: 5px;
    }

    .incomplete-bar {
        height: 100%;
        background-color: #f44336;
        border-radius: 5px;
    }

    .progress-text {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        line-height: 20px;
    }
</style>

<div class="progress-bar">
    <!-- Calculate the percentage of completed tasks -->
    {% set percentage_completed = (n_completed / last) * 100 %}
    <!-- Render the completed bar -->
    <div class="completed-bar" style="width: {{ percentage_completed }}%"></div>
    <!-- Render the incomplete bar -->
    <div class="incomplete-bar" style="width: {{ 100 - percentage_completed }}%"></div>
    <!-- Display the progress text -->
    <div class="text-success"><strong>{{ n_completed }} / {{ last }} samples đã hoàn thành cross-checked</strong></div>
</div>

<br>

<!-- Options -->
<div class="d-flex justify-content-center">
    <button class="btn btn-primary mr-3" id="previous" onclick="window.location.href='/cross_check/?index={{ rcmt_idx - 1 }}'">
        <i class="fas fa-arrow-left"></i> Lui lại
    </button>
    <button class="btn btn-primary mr-3" id="from-beginning" onclick="window.location.href='/cross_check/?index=1'">
        <i class="fas fa-fast-backward"></i> Từ đầu
    </button>
    <button class="btn btn-primary mr-3" id="from-end" onclick="window.location.href='/cross_check/?index={{ last }}'">
        <i class="fas fa-fast-forward"></i> Nhảy đến cuối
    </button>
    <button class="btn btn-primary mr-3" id="next" onclick="window.location.href='/cross_check/?index={{ rcmt_idx + 1 }}'">
        <i class="fas fa-arrow-right"></i> Tiếp theo
    </button>
</div>
<style>
    /* Add custom CSS styles */
    body, html {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    .form-container {
        display: flex;
        flex-direction: column; /* Change to column direction */
        align-items: flex-start;
        padding: 20px;
    }
    form {
        max-width: 1000px; /* Limit the maximum width of the form */
    }
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
    }
    /* Highlight the aspect row */
    tr.aspect-row {
        background-color: #f2f2f2;
    }
    /* Adjust the margin of the submit button */
    .submit-btn {
        margin-top: 15px; /* Change this value to adjust the gap */
    }
</style>

<!-- Extract cross checking reviews -->
{% if ck_data is not none %}
    <h2 class="text-success text-center">Mẫu số <strong>{{ current_idx }}</strong>. Bạn đã cross-checked mẫu dữ liệu này. Bạn đang cập nhật!</h2>
    {% set cross_check_review = ck_data.cross_check_review %}
    {% set is_accepted = ck_data.is_accepted %}
{% else %}
    <h2 class="text-danger text-center">Mẫu số <strong>{{ current_idx }}</strong>. Bạn chưa từng cross-checked mẫu dữ liệu này!</h2>
    {% set cross_check_review = '' %}
    {% set is_accepted = False %}
{% endif %}


<!-- cross-checking -->
<form action="{{ url_for('views.cross_check', index=current_idx) }}" method="post">
    <!-- cross-checking Input -->

    <div class="cross-checking-inputs">
        <label for="is_ccepted">Okay or not?</label>
        <input type="checkbox" id="is_accepted" name="is_accepted" {% if is_accepted %}checked{% endif %}>

        <br>

        <label for="cross_check_review">Viết câu cross-checking review:</label>
        <textarea name="cross_check_review" id="cross_check_review" rows="2" style="width: 100%;">{{ cross_check_review }}</textarea>
    </div>

    <!-- Submit button -->
    <div class="submit-btn text-center">
        <input type="submit" value="Submit">
    </div>
    <br>

    <!-- View Data -->
    <label for="label">Nhãn:</label> {% if ann_data is none %} Chưa gán {% else %} <strong>{{ ann_data['label'] }}</strong> {% endif %}
    <br>
    <label for="explanation">Câu giải thích:</label> {% if ann_data is none %} Chưa gán {% else %} <strong>{{ ann_data['explanation'] }}</strong> {% endif %}
    <table>
        {% for aspect, attributes in rcmt_data.items() %}
            <!-- Each aspect -->
            <tr class="aspect-row">
                <th colspan="2">{{ aspect }}</th>
                <td>
                    {% if ann_data is none %} Chưa gán {% else %} <strong>{{ ann_data[aspect] }}</strong> {% endif %}
                    <!-- {{ "Chưa gán" if ann_data[aspect] is none else ann_data[aspect] }} -->
                </td>
            </tr>
            {% for attribute, value in attributes.items() %}
                {% if value is not none %}
                <tr>
                    <td>{{ attribute }}</td>
                    {% if attribute == 'body' %}
                        <td>{{ value|safe }}</td>
                    {% else %}
                        <td>{{ value }}</td>
                    {% endif %}
                    <td></td> <!-- Add an empty column for the select option -->
                </tr>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </table>
    <br>
</form>

{% endblock %}